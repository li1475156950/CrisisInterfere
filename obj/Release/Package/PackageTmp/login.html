<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>京师博仁危机干预-登录</title>
    <link rel="shortcut icon" id="icons" href="" />
    <!-- Bootstrap Styles-->
    <link href="CSS/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <link href="CSS/last.css" rel="stylesheet" />
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link href="CSS/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLES-->
    <link href="assets/css/custom.css" rel="stylesheet" />
    <!-- GOOGLE FONTS-->
    <!--<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />-->
    <!-- BOOTSTRAP bootstrapValidator-->
    <link href="css/bootstrapValidator.min.css" rel="stylesheet" />
    <!-- GOOGLE LAYER-->
    <link href="assets/skin/layer.css" rel="stylesheet" />
    <link rel="shortcut icon" href="favicon.ico" />
    <script src="assets/js/login/jquery.js"></script>
    <style type="text/css">
        html {
            height: 100%;
        }

        body {
            background: url(Img/login.png) no-repeat;
            background-size: cover;
        }

        .checkboxFour {
            float: left;
            width: 20px;
            height: 20px;
            background: #fff;
            /*margin: 20px 90px;*/
            border-radius: 100%;
            position: relative;
            -webkit-box-shadow: 0px 1px 3px rgba(0,0,0,0.5);
            -moz-box-shadow: 0px 1px 3px rgba(0,0,0,0.5);
            box-shadow: 0px 1px 3px rgba(0,0,0,0.5);
        }

            .checkboxFour label {
                display: block;
                width: 12px;
                height: 12px;
                border-radius: 100px;
                -webkit-transition: all .5s ease;
                -moz-transition: all .5s ease;
                -o-transition: all .5s ease;
                -ms-transition: all .5s ease;
                transition: all .5s ease;
                cursor: pointer;
                position: absolute;
                top: 4px;
                left: 4px;
                z-index: 1;
                background: #fff;
                -webkit-box-shadow: inset 0px 1px 3px rgba(0,0,0,0.5);
                -moz-box-shadow: inset 0px 1px 3px rgba(0,0,0,0.5);
                box-shadow: inset 0px 1px 3px rgba(0,0,0,0.5);
            }
            .checkboxFour input[type=checkbox]:checked + label {
                background: #50ace2;
            }
    </style>
</head>
<body>
    <div class="login_box">
        <div align="center" class="top">
            <img src="Img/x_logo.png" />
        </div>
        <form role="form" id="loginForm" method="post">
            <div class="bottom row">
                <div class="form-group">
                    <span><i class="icon iconfont">&#xec03;</i></span>
                    <input type="text" id="loginName" name="loginName" placeholder="用户名" autocomplete="off">
                </div>
                <div class="form-group mt25">
                    <span><i class="icon iconfont">&#xec12;</i></span>
                    <input type="password" id="loginPwd" name="loginPwd" placeholder="密码">
                </div>
                <div class="form-group">
                    <div style="margin-top:5px;">
                        <div class="checkboxFour">
                            <input type="checkbox" value="1" style="display:none;" id="rememberPwd" name="">
                            <label for="rememberPwd"></label>
                        </div>
                        <label style="margin-left: 5px;font-size:15px;color: #eee;" for="rememberPwd">记住密码</label>
                    </div>
                </div>
                <button type="submit" id="submitas" class="x_btn">登录</button>
            </div>
        </form>
    </div>
    <script src="assets/js/jquery-1.10.2.js"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="assets/js/jquery.metisMenu.js"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="assets/js/custom.js"></script>
    <!-- LAYER SCRIPTS -->
    <script src="js/layer.js"></script>
    <script src="js/bootstrapValidator.min.js"></script>
    <script src="JS/bootstrap-datepicker.js"></script>
    <script src="JS/ligerComboBox/ligerTree.js"></script>
    <script src="JS/ligerComboBox/ligerComboBox.js"></script>
    <script type="text/javascript">
        //样式
        Yang();
        function Yang() {
            var lock = false;
            if (/AppleWebKit.*Mobile/i.test(navigator.userAgent) || (/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))) {
                if (window.location.href.indexOf("?mobile") < 0) {
                    try {
                        if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
                            // 判断访问环境是 Android|webOS|iPhone|iPod|BlackBerry 则加载以下样式
                            setActiveStyleSheet("../../CSS/mobile.css");
                        }
                        else if (/iPad/i.test(navigator.userAgent)) {
                            // 判断访问环境是 iPad 则加载以下样式
                            setActiveStyleSheet("../../CSS/pc.css");
                        }
                        else {
                            // 判断访问环境是 其他移动设备 则加载以下样式
                            setActiveStyleSheet("../../CSS/pc.css");
                        }
                    }
                    catch (e) { }
                }
            }
            else {
                // 如果以上都不是，则加载以下样式
                setActiveStyleSheet("../../CSS/pc.css");
            }
            $("#regName").focus(function () {
                if ($("#regName").val() == "") {
                    $("#loginNameRule").show();
                }
            })
            jQuery(function ($) {

                txtValue = $("#loginName").val();

                ////////    给txtbox绑定键盘事件
                $("#loginName").bind("keydown", function () {
                    var currentValue = $(this).val();
                    $.ajax({
                        url: "Ajax/LoginAndRegister.ashx?operationType=ClearPwd",
                        type: "GET",
                        data: { loginName: currentValue },
                        dataType: "json",
                        success: function (result) {
                            if (result.State) {
                                $("#loginPwd").val(result.Data);
                            }
                            else {
                                $("#loginPwd").val("");
                            }
                        }
                    })

                });

            });
            function setActiveStyleSheet(filename) {
                var html = "<link href='" + filename + "' rel='stylesheet'>";
                $("head").append(html);
            }
            GetCookieValue();
            function GetCookieValue() {
                $.ajax({
                    url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=GetCookie",
                    dataType: "json",
                    success: function (data) {
                        if (data != undefined) {
                            if (data["loginNameCookie"] != "@@") {
                                $("#loginName").val(data["loginNameCookie"]);
                                $("#loginPwd").val(data["loginPwdCookie"]);
                                $("#rememberPwd")[0].checked = true;
                            }
                            else {
                                data["loginNameCookie"] == "";
                                document.getElementById("loginName").value = "";
                                $("#loginName").val("");
                                $("#loginPwd").val("");
                            }
                        }

                    }
                })
            }
            function ShowRegisterPage() {
                $(".register-box").show();
                $(".box").css("height", "1150px");

                $(".login-box").hide();
            }
            function ShowLoginPage() {
                $(".register-box").hide();
                $(".box").css("height", "100%");

                $(".login-box").show();
            }
        }
        //登陆
        login();
        function login() {
            $('#loginForm').bootstrapValidator({
                message: '表单验证失败.',
                feedbackIcons: {
                    //valid: 'glyphicon glyphicon-ok',
                    //invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    loginName: {
                        message: '用户名验证失败',
                        validators: {
                            notEmpty: {
                                message: '用户名不能为空'
                            },
                            //stringLength: {
                            //    min: 2,
                            //    max: 20,
                            //    message: '用户名长度必须介于2到20之间'
                            //},
                            threshold: 2,
                        }
                    }, loginPwd: {
                        message: '密码格式不正确',
                        validators: {
                            notEmpty: {
                                message: '用户密码不能为空'
                            },
                            //stringLength: {
                            //    min: 6,
                            //    max: 30,
                            //    message: '用户名密码不能小于6位，且不能大于30位'
                            //},
                        }

                    },
                    //Ename: {
                    //    message: '企业账号验证失败',
                    //    validators: {
                    //        notEmpty: {
                    //            message: '企业账号不能为空'
                    //        },

                    //    }
                    //},
                }
            }).on('success.form.bv', function (e) {
                e.preventDefault();

                $.ajax({
                    url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=login",
                    type: "GET",
                    data: {
                        loginName: $("#loginName").val(),
                        pwd: $("#loginPwd").val(),
                        rememberPwd: $("#rememberPwd")[0].checked,
                        ENameS: $("#EnameA").val()
                    },
                    dataType: "text",
                    success: function (data) {
                        if (data == 1) {
                            window.location.href = "Index.aspx";
                        } else if (data == 3) {
                            layer.confirm('序列号没有激活是否要激活？', {
                                btn: ['确定', '取消'] //按钮
                            }, function () {
                                //  $("#myModal").modal('show');
                                layer.closeAll("dialog");
                                L_Activation();

                            });
                            //弹框
                        } else if (data == 4) {
                            layer.alert('企业账号错误！', {
                                skin: 'layui-layer-lan', //样式类名
                                closeBtn: 0
                            });
                        } else if (data == 5) {
                            layer.alert('该企业授权已失效！', {
                                skin: 'layui-layer-lan', //样式类名
                                closeBtn: 0
                            });
                        }
                        else {
                            layer.alert('登录失败,用户名或密码错误', {
                                skin: 'layui-layer-lan', //样式类名
                                closeBtn: 0
                            });
                        }
                    }
                })

            })
        }
        // 查询按钮绑定回车键
        $(document).keydown(function (event) {
            if (event.keyCode == 13) {
                $("#submitas").click();
            }
        });
        function YZXLH() {
            $.ajax({
                url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=YZXLH",
                type: "GET",
                data: { xlhname: $("#xlhname").val(), password: $("#password").val() },
                dataType: "text",
                success: function (data) {
                    if (data == 1) {
                        window.location.href = "Index.aspx?type=1";
                    } else if (data == 2) {
                        layer.alert('序列号不正确', {
                            skin: 'layui-layer-lan', //样式类名
                            closeBtn: 0
                        });
                        return;
                    } else if (data == 3) {
                        layer.alert('还没有激活', {
                            skin: 'layui-layer-lan', //样式类名
                            closeBtn: 0
                        });
                        return;
                    }
                    else {
                        layer.alert('激活失败！', {
                            skin: 'layui-layer-lan', //样式类名
                            closeBtn: 0
                        });
                    }
                }
            })
        }
        function L_Activation() {
            layer.open({
                type: 1
                , title: false //不显示标题栏
                , closeBtn: false
                , area: '300px;'
                , shade: 0.8
                , id: 'LAY_layuipro' //设定一个id，防止重复弹出
                , btn: ['保存', '取消']
                , moveType: 1 //拖拽模式，0或者1
                , content: ' <div style="padding: 50px;  line-height: 22px; background-color:#ffffff; font-weight: 300;"><input type="text" id="xlhname" name="xlhname" style="width: 100%;" placeholder="输入序列号" /></div><div style="padding: 0px 50px 50px 50px; line-height: 22px; background-color:#ffffff; font-weight: 300;"><input id="password" type="password" name="password" style="width: 100%;" placeholder="请输入激活码" /></div>'
                , success: function (layero) {
                    var btn = layero.find('.layui-layer-btn');
                    btn.css('text-align', 'center');
                    btn.find('.layui-layer-btn0').attr("onclick", "YZXLH()");
                }
            });
        }
    </script>
</body>
</html>
