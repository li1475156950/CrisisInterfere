<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>京师博仁危机干预心理测验-查看结果</title>
    <link rel="shortcut icon" id="icons" href="" />
    <!-- Bootstrap Styles-->
    <link href="/CSS/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <!-- Custom Styles-->
    <link href="/CSS/custom-styles.css" rel="stylesheet" />
    <link href="/CSS/custom-styles_1.css" rel="stylesheet" />
    <link href="/CSS/font-awesome.min.css" rel="stylesheet" />
    <link href="/CSS/base.css" rel="stylesheet" />
    <link href="/CSS/rysz.css" rel="stylesheet" />
    <link href="/CSS/bootstrap-datepicker.css" rel="stylesheet" />
    <link href="/assets/skin/layer.css" rel="stylesheet" />
    <link href="/CSS/bootstrapValidator.min.css" rel="stylesheet" />
    <link href="/CSS/ligerFrom/ligerui-form.css" rel="stylesheet" />
    <link href="/CSS/ligerFrom/ligerui-tree.css" rel="stylesheet" />
    <link href="/JS/datatables/media/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="/CSS/morris-0.4.3.min.css" rel="stylesheet" />
</head>
<body>
    <div id="wrapper">
        <!-- 头部导航 -->
        <nav class="navbar navbar-default top-navbar" role="navigation">
            <div>
                <a class="navbar-brand" href="/Index.aspx" style="width: auto;">
                    <img class="pull-left" src="./statics/images/w_logo.png" id="newbox" />
                    <p class="white fb f24 pull-left">京师博仁心理危机干预系统</p>
                </a>
            </div>

            <ul class="nav navbar-top-links navbar-right pr30">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <img src="./statics/images/w_email.png">
                    </a>
                    <ul class="dropdown-menu dropdown-messages" id="MsgID">
                        <li id="lis1">
                            <a href="../../FunctionModular/Letter/LetterList.aspx">
                                <div>
                                    <span class="pull-right text-muted">
                                        <em></em>
                                    </span>
                                </div>
                                <div>暂无消息</div>
                            </a>
                        </li>
                        <li class="divider" id="divider1" style="display: none"></li>
                        <li id="lis2" style="display:none">
                            <a href="../../FunctionModular/Letter/LetterList.aspx">
                                <div>

                                    <span class="pull-right text-muted">
                                        <em></em>
                                    </span>
                                </div>
                                <div>暂无消息</div>
                            </a>
                        </li>
                        <li class="divider" id="divider2" style="display: none"></li>
                        <li id="lis3" style="display:none">
                            <a href="../../FunctionModular/Letter/LetterList.aspx">
                                <div>
                                    <span class="pull-right text-muted">
                                        <em></em>
                                    </span>
                                </div>
                                <div>暂无消息</div>
                            </a>
                        </li>
                        <li class="divider" id="divider3" style="display: none"></li>
                        <li>
                            <a class="text-center" href="../../FunctionModular/Letter/LetterList.aspx">
                                <strong>查看所有消息</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <img class="pull-left" src="./statics/images/w_tx.png">
                        <p class="f16 white pull-left">Yilia_S</p>
                        <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li>
                            <a href="/FunctionModular/PersonalInfo/PersonalInfo.aspx"><i class="fa fa-user fa-fw"></i>个人信息</a>
                        </li>

                        <li class="divider"></li>
                        <li>
                            <a onclick="LoginOut()"><i class="fa fa-sign-out fa-fw"></i>退出登录</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
        <!-- 左侧  -->
        <nav class="navbar-default navbar-side w_color" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
                    <li class="w_blue">
                        <a id="MyIndex" href="../../Index.aspx"><i class="fa fa-desktop c666"></i>桌面</a>
                    </li>
                    <li>
                        <a class="zhuse" href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic1.png" alt=""></i>人员设置<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse in">
                            <li><a data-id="10" href="/FunctionModular/BasicSetting/RoleManagement.aspx" onclick="return OnSetCollapseIn(this);">角色管理</a></li>
                            <li><a data-id="11" href="/FunctionModular/BasicSetting/DepartmentMain.aspx" onclick="return OnSetCollapseIn(this);">部门管理</a></li>
                            <li class="xia_acitve"><a data-id="12" href="/FunctionModular/BasicSetting/MemberManagement.aspx" onclick="return OnSetCollapseIn(this);">成员管理</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic2.png" alt=""></i>心理测评<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="14" href="/FunctionModular/Heartevaluation/Heartevaluation.aspx" onclick="return OnSetCollapseIn(this);">量表管理</a></li>
                            <li><a data-id="15" href="/FunctionModular/HeartEvaluation_DistributionRecord/DistributionRecord.aspx" onclick="return OnSetCollapseIn(this);">分配记录</a></li>
                            <li><a data-id="16" href="/FunctionModular/PersonalReport/PersonalReport.aspx" onclick="return OnSetCollapseIn(this);">个体报告</a></li>
                            <li><a data-id="17" href="/FunctionModular/GroupReport/GroupReport.aspx" onclick="return OnSetCollapseIn(this);">团体报告</a></li>
                            <li><a data-id="18" href="/FunctionModular/StatisticalAnalysis/Statistical.aspx" onclick="return OnSetCollapseIn(this);">统计分析</a></li>
                            <li><a data-id="19" href="/FunctionModular/HeartEvaluation/MyTest.aspx" onclick="return OnSetCollapseIn(this);">我的测验</a></li>
                            <li><a data-id="20" href="/FunctionModular/HeartEvaluation/ViewResult.aspx" onclick="return OnSetCollapseIn(this);">查看结果</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic3.png" alt=""></i>危机干预<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="21" href="/FunctionModular/Warning/CrisisWarning.aspx" onclick="return OnSetCollapseIn(this);">危机预警</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic4.png" alt=""></i>预约咨询<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="23" href="/FunctionModular/Questionnaire_Record/Questionnaire_Manage.aspx" onclick="return OnSetCollapseIn(this);">问卷管理</a></li>
                            <li><a data-id="24" href="/FunctionModular/Questionnaire_Record/QuestionnaireRecord.aspx" onclick="return OnSetCollapseIn(this);">分配记录</a></li>
                            <li><a data-id="25" href="/FunctionModular/Questionnaire_Record/SurveyResult.aspx" onclick="return OnSetCollapseIn(this);">调查结果</a></li>
                            <li><a data-id="26" href="/FunctionModular/Questionnaire_Record/MyQuestionnaire.aspx" onclick="return OnSetCollapseIn(this);">我的问卷</a></li>
                            <li><a data-id="27" href="/FunctionModular/Questionnaire_Record/AnwserRecord.aspx" onclick="return OnSetCollapseIn(this);">作答记录</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic5.png" alt=""></i>档案管理<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="28" href="/FunctionModular/AppointmentConsult/QuestionType.aspx" onclick="return OnSetCollapseIn(this);">参数设置</a></li>
                            <li><a data-id="29" href="/FunctionModular/AppointmentConsult/AppointmentManagement.aspx" onclick="return OnSetCollapseIn(this);">预约管理</a></li>
                            <li><a data-id="34" href="/FunctionModular/AdvisoryStatistics/AdvisoryStatistics.aspx" onclick="return OnSetCollapseIn(this);">咨询统计</a></li>
                            <li><a data-id="35" href="/FunctionModular/AppointmentConsult/CaseanalysisList.aspx" onclick="return OnSetCollapseIn(this);">案例分析</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic6.png" alt=""></i>其他服务<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="37" href="/FunctionModular/EvaluationFiles/EvaluationFiles.aspx" onclick="return OnSetCollapseIn(this);">测评档案</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic7.png" alt=""></i>危机预防方案<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="37" href="/FunctionModular/EvaluationFiles/EvaluationFiles.aspx" onclick="return OnSetCollapseIn(this);">测评档案</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" onclick="return OnSetCollapseIn(this);"><i class="null"><img src="./statics/images/w_xpic8.png" alt=""></i>回收站<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a data-id="140" href="/FunctionModular/RecycleBin/RecycleBin.aspx" onclick="return OnSetCollapseIn(this);">回收站</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- 右侧  -->
        <div id="page-wrapper">

            <div id="page-inner">

                <!-- /. ROW  -->
                <div class="row" style="margin-left: 9px; margin-bottom: 20px;">
                    <div class="col-md-2 col-sm-12 col-xs-12" style="margin-top: 10px;">
                        <input id="Sel_AmountName" type="text" class="selectpicker form-control" data-done-button="true" placeholder="--量表名称--" />
                    </div>
                    <div class="col-md-2 col-sm-12 col-xs-12" style="text-align: right; margin-top: 10px;">
                        <button id="go_search" class="btn btn-primary btn-sm pull-left" name="QX_SelectViewResult" style="border: 1px solid #f9906f;color: #f9906f;padding: 5px 21px;"><i class="fa fa-search "></i>查询</button>


                    </div>
                </div>

                <div class="row" style="margin-left: 9px;">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <!-- Advanced Tables -->
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="tableGrid">
                                <thead>
                                    <tr>
                                        <th class="text-center" style="width: 1%;">
                                            <input type="checkbox" id="allCheck" />
                                        </th>
                                        <th class="text-center" style="width: 8%;">序号</th>
                                        <th class="text-center">量表名称</th>
                                        <th class="text-center">完成时间</th>
                                        <th class="text-center">操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>

                        </div>

                        <!--End Advanced Tables -->
                    </div>
                </div>
            </div>
        </div>
</body>
</html>
<!-- JS Scripts-->
<!-- 左侧下拉框 Js -->
<script src="/JS/jquery-2.0.3.min.js"></script>
<script src="/JS/jquery.metismenu.js"></script>
<script src="/JS/custom-scripts.js"></script>
<script src="/JS/bootstrap.min.js"></script>
<script type="text/javascript" src="/JS/datatables/media/js/jquery.dataTables.min.js"></script>
<script src="/JS/bootstrap-datepicker.js"></script>
<script src="/JS/ligerComboBox/ligerComboBox.js"></script>
<script src="/JS/layer.js"></script>
<script src="/JS/bootstrapValidator.min.js"></script>
<script src="/JS/ligerComboBox/ligerTree.js"></script>


<input type="hidden" id="DepIDs" />
<script src="../../JS/layer.js"></script>
<script src="../../JS/datatables/media/js/jquery.dataTables.min.js"></script>
<script>
    var navName = '/FunctionModular/HeartEvaluation/ViewResult.aspx';
    //initSelectInput("Remark=1", "Sel_AmountName", "量表名称")
    //function initSelectInput(types, controlname, Exhibition) {
    //    $("#" + controlname).empty();
    //    if (Exhibition != "") {
    //        $("#" + controlname).append("<option value='0'>" + Exhibition + "</option>");
    //    }
    //    $.ajax({
    //        type: "POST",
    //        url: "/FunctionModular/HeartEvaluation_DistributionRecord/Ajax/DistributionRecord.ashx?operationType=LoadAmountName",
    //        data: types,//要执行查询的数据参数
    //        success: function (msg) {
    //            $.each(eval(msg), function (index, item) {
    //                $("#" + controlname).append("<option value='" + item["_amount_id"] + "'>" + item["_amount_name"] + "</option>");

    //            });

    //        }
    //    });
    //}
    /*-----初始化下拉列表公共方法-----*/
    //function initSelectInput(types, controlname, Exhibition) {
    //    $("#" + controlname).empty();
    //    if (Exhibition != "") {
    //        $("#" + controlname).append("<option value='0'>" + Exhibition + "</option>");
    //    }
    //    $.ajax({
    //        type: "POST",
    //        url: "/FunctionModular/HeartEvaluation_DistributionRecord/Ajax/DistributionRecord.ashx?operationType=LoadAmountName",
    //        data: types,//要执行查询的数据参数
    //        success: function (msg) {
    //            $.each(eval(msg), function (index, item) {
    //                $("#" + controlname).append("<option value='" + item.Value + "'>" + item.Text + "</option>");

    //            });
    //            $("#" + controlname).attr("multiple", false);

    //            $("#" + controlname).selectpicker('refresh');

    //        }
    //    });
    //}



    var Startindex = 0;//开始条数索引
    var Endindex = 10;//结束条数索引
    var amountID = 0;
    var nameLB = "";
    var isLoadDataTable = true; // 是否为第一次初始化数据
    var tablelist;

    BindGrid();
    function BindGrid() {
        if (tablelist != undefined) {
            $("#tableGrid").DataTable().draw();
            return;
        }
        tablelist = $('#tableGrid').dataTable({
            serverSide: true,//分页，取数据等等的都放到服务端去
            searching: false,
            bLengthChange: false,//是否显示分页条数（就是那个显示页面条数的下拉按钮）
            pageLength: 10,//首次加载的数据条数
            ordering: false,//排序操作在服务端进行，所以可以关了。
            processing: true,//载入数据的时候是否显示“载入中”
            clickToSelect: true,
            //aoColumnDefs: [
            //    { //隐藏列
            //        bVisible: false,
            //        aTargets: [0]
            //    },
            //],
            ajax: {
                method: 'get',
                url: "Ajax/ViewResult.ashx?operationType=Bind",
                dataSrc: "data",
                data: function (d) {

                    var pageIndex = fnGetRequiredPageIndex();
                    // 当初始化的时候
                    if (isLoadDataTable && $("#tableGrid").DataTable().page() != pageIndex) {
                        d.start = pageIndex * d.length;
                    }

                    //d.start;//开始的序号
                    //d.length;//要取的数据的
                    Endindex = 0;
                    Startindex = 0;
                    if (d.start == 0) {
                        Endindex = d.length;
                    } else {
                        Startindex = d.start + 1;
                        Endindex = d.start + d.length;
                    }
                    return 'StartPageIndex=' + Startindex + '&EndPageIndex=' + Endindex + '&nameLB=' + nameLB;
                }
            },

            createdRow: function (row, data, dataIndex) {

                var lookUrl = "";
                // 当前页码
                var tablePageIndex = $("#tableGrid").DataTable().page() + 1;

                // 当初始化的时候
                var pageIndex = fnGetRequiredPageIndex();
                if (isLoadDataTable && $("#tableGrid").DataTable().page() != pageIndex) {
                    tablePageIndex = pageIndex + 1;
                }

                // 获取查看跳转的地址
                function getLookUrl(urlType, aId, contenType, amountType) {
                    var result = "";
                    switch (urlType) {
                        case 1: // MMPI报告 lookMMPI
                            result = "MMPI_Report.aspx?A_ID=" + aId + "&type=1" + "&AmountType=" + 1 + "&p=" + tablePageIndex;
                            break;
                        case 2: // LookR
                            result = "LookReport.aspx?A_ID=" + aId + "&type=1" + "&AmountType=" + amountType + "&p=" + tablePageIndex;
                            break;
                        case 3: // 特殊量表 LookRS
                            result = "SpecialReport.aspx?A_ID=" + aId + "&type=1" + "&types=" + contenType + "&AmountType=" + amountType + "&p=" + tablePageIndex;
                            break;
                        case 4: // 特殊量表M LookRSS
                            result = "SpecialReportM.aspx?A_ID=" + aId + "&type=1" + "&types=" + contenType + "&AmountType=" + amountType + "&p=" + tablePageIndex;
                            break;
                    }

                    return result;
                }

                //if (data[8] == 2) {
                if (data[5] == "LB_14814373314360") {
                    lookUrl = getLookUrl(4, data[7], 1, data[6]);
                }
                else if (data[5] == "LB_14809941842260" || data[5] == "LB_14811084564180" || data[5] == "LB_14810118744850") {
                    lookUrl = getLookUrl(3, data[7], 3, data[6]);

                } else if (data[5] == "LB_14809227671290") {
                    lookUrl = getLookUrl(4, data[7], 4, data[6]);
                }
                else if (data[5] == "LB_14809953564280" || data[5] == "LB_14809270976120" || data[5] == "LB_14810979035220") {
                    lookUrl = getLookUrl(3, data[7], 6, data[6]);
                }
                else if (data[5] == "LB_14811852410670") {
                    lookUrl = getLookUrl(3, data[7], 8, data[6]);
                } else if (data[5] == "LB_14812009694200") {
                    lookUrl = getLookUrl(3, data[7], 801, data[6]);
                } else if (data[5] == "LB_14811639146570") {
                    lookUrl = getLookUrl(3, data[7], 802, data[6]);
                }
                    //else if (data[5] == "LB_14811639146570")
                    //    {
                    //     operation += " <button  class=\"btn btn-link\" name='QX_SelectReport' data-name='lookReportS'onclick=LookRS(" + data[7] + ",802," + data[6] + ")>查看报告</button>"
                    //}
                else if (data[5] == "LB_14812009852840") {
                    lookUrl = getLookUrl(3, data[7], 9, data[6]);
                } else if (data[5] == "LB_14811658719780") {
                    lookUrl = getLookUrl(3, data[7], 901, data[6]);
                }
                else if (data[5] == "LB_14811661311050") {
                    lookUrl = getLookUrl(4, data[7], 11, data[6]);
                } else if (data[5] == "LB_14812024172130") {
                    lookUrl = getLookUrl(4, data[7], 13, data[6]);
                }
                else if (data[5] == "LB_14811899636250") {
                    lookUrl = getLookUrl(1, data[7], null, null);
                }
                else if (data[5] == "LB_14811899593960") {
                    lookUrl = getLookUrl(3, data[7], 14, data[6]);
                }
                else if (data[5] == "LB_14812458422370") {
                    lookUrl = getLookUrl(4, data[7], 17, data[6]);
                } else if (data[5] == "LB_14811181207060") {
                    lookUrl = getLookUrl(3, data[7], 10, data[6]);
                } else if (data[5] == "LB_14808297050440") {
                    lookUrl = getLookUrl(4, data[7], 16, data[6]);
                } else if (data[5] == "LB_14811056565390") {
                    lookUrl = getLookUrl(4, data[7], 7, data[6]);
                }
                else if (data[5] == "LB_14809330635970") {
                    lookUrl = getLookUrl(4, data[7], 15, data[6]);
                } else if (data[5] == "LB_14824009961900") {
                    lookUrl = getLookUrl(4, data[7], 18, data[6]);
                } else if (data[5] == "LB_14963937158670") {
                    lookUrl = getLookUrl(4, data[7], 19, data[6]);
                } else if (data[5] == "LB_14966568047910") {
                    lookUrl = getLookUrl(4, data[7], 20, data[6]);
                } else if (data[5] == "LB_14963915437340") {
                    lookUrl = getLookUrl(4, data[7], 21, data[6]);
                }
                else {
                    lookUrl = getLookUrl(2, data[7], null, data[6]);
                }


                var btnLook = $(" <button  class=\"btn btn-link\" name='QX_SelectReport' data-name='lookReportS' >查看报告</button>");
                btnLook.on("click", function () {
                    $.ajax({
                        url: "Ajax/ViewResult.ashx?operationType=LookType",
                        type: "GET",
                        data: { A_ID: data[7] },
                        dataType: "Text",
                        success: function (data) {
                            if (data == "2") {
                                window.location.href = "../PersonalReport/" + lookUrl;
                            }
                            else {
                                layer.alert('未获得相关权限！', {
                                    skin: 'layui-layer-lan', //样式类名
                                    closeBtn: 0,
                                });
                            }
                        }
                    });
                });

                $('td:eq(0)', row).css("text-align", "center");
                $('td:eq(1)', row).css("text-align", "center");
                $('td:eq(4)', row).append(btnLook);
                $('td:eq(4)', row).append("<button  class=\"btn btn-link\"data-remove='remove' name='QX_DelectReport'>删除</button>");
            },
            "oLanguage": {
                "sProcessing": "处理中...",
                "sLengthMenu": "_MENU_ 记录/页",
                "sZeroRecords": "没有匹配的记录",
                "sInfo": "显示第 _START_ 至 _END_ 项记录，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项记录，共 0 项",
                "sInfoFiltered": "",
                "sInfoPostFix": "",
                "sSearch": "过滤:",
                "sUrl": "",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                }
            },
            initComplete: function (setting, json) {

                // 获取请求的页码
                var pageIndex = fnGetRequiredPageIndex();
                if ($("#tableGrid").DataTable().page() != pageIndex) {
                    $('#tableGrid').dataTable().fnPageChange(pageIndex);
                }
                isLoadDataTable = false;

            },
            drawCallback: function (s) {
                $("#tableGrid_info").css("margin-bottom", "5px");

                var htmls = "";
                htmls += "<button onclick=\"BulkDelete()\"style='margin-left:10px;' name='QX_DelReport' data-toggle=\"modal\" data-target=\"#x_dels\" class=\"btn btn-or w_radius\" style=\"height: 22px; padding-top: 0px;\"> <i class=\"icon iconfont \">&#xeb8d;</i>批量删除</button>";
                $("#tableGrid_info").html(htmls);
               

            }
        });
    }

    // 获取地址栏参数
    function fnGetUrlParam(paramName) {
        var result = "";

        var usr = window.location.href;
        var ul = usr.toString().split('?');
        if (ul.length == 2) {
            var params = ul[1].split('&');
            for (var i = 0; i < params.length; i++) {
                var param = params[i].split('=');
                if (param.length == 2) {
                    if (param[0] + "" == paramName) {
                        result = param[1];
                        break;
                    }
                }
            }
        }

        return result;
    }
    // 获取请求页码
    function fnGetRequiredPageIndex() {
        var pageIndex = fnGetUrlParam("p");
        var result = /^[1-9]\d*$/.test(pageIndex) ? Number(pageIndex) - 1 : 0;

        return result;
    }

    $(document).on("click", "#go_search", function () {

        nameLB = $("#Sel_AmountName").val();

        if (tableGrid != undefined) {
            $("#allCheck")[0].checked = false;
            $("#tableGrid").DataTable().draw();
            return;
        }
    });
    $(document).on("click", "[data-remove=remove]", function () {
        var answerAddID = $(this).parent().parent().find("input[type=checkbox]").attr("data-id");

        var name = $(this).parent().parent().find("input[type=checkbox]").attr("data-name");
        DeleteAnswerAdd(answerAddID, name);
    })
    function DeleteAnswerAdd(val, name) {

        layer.confirm("确认删除此报告吗？", {
            btn: ["确定", "取消"]
        }, function () {
            $.ajax({
                url: "Ajax/ViewResult.ashx?operationType=DeleteViewResult",
                type: "GET",
                data: { answerAddID: val, name: name },
                dataType: "Text",
                success: function (data) {
                    if (data == "True") {
                        layer.msg('删除成功', { time: 2000, icon: 1 }, function () {
                            layer.closeAll('dialog');
                            $("[name='checkbox']").removeAttr("checked");//取消选中
                            $("#tableGrid").dataTable().fnDraw(false);
                        });
                    }
                    else {
                        layer.msg('删除失败', { time: 2000, icon: 2 }, function () {
                            layer.closeAll('dialog');
                            $("#tableGrid").dataTable().fnDraw(false);
                        });
                    }
                }
            })
        })

    }
    function BulkDelete() {
        var tempAnswerAddArray = $("#tableGrid").find("input[type=checkbox]").not("#allCheck");
        var name = $("#tableGrid").find("input[type=checkbox]").not("#allCheck");
        var answerID = '';
        var names = '';
        //for (var i = 0; i < name.length; i++) {
        //    alert($(name[i]).attr("data-name"));
        //}

        var isDelete = false;
        for (var i = 0; i < tempAnswerAddArray.length; i++) {
            if ($(tempAnswerAddArray[i])[0].checked) {
                isDelete = true;

            }
        }

        if (!isDelete) {
            layer.alert("请选择要删除的测试结果", {
                skin: "layui-layer-lan",
                closeBtn: 0
            })
            return;
        }
        for (var i = 0; i < tempAnswerAddArray.length; i++) {
            if ($(tempAnswerAddArray[i])[0].checked) {

                answerID += $(tempAnswerAddArray[i]).attr("data-id") + ",";
                names += $(name[i]).attr("data-name") + ",";
            }
        }
        DeleteAnswerAdd(answerID, names);
    }
    $(document).on("click", ".checkAnswerAdd", function () {

        var isAllCheck = true;
        var checkArray = $("#tableGrid").find("input[type=checkbox]").not("#allCheck");
        for (var i = 0; i < checkArray.length; i++) {
            if (!checkArray[i].checked) {
                isAllCheck = false;
            }
        }

        $("#allCheck")[0].checked = isAllCheck;
    })
    $(document).on("click", "#allCheck", function () {
        var checkArray = $("#tableGrid").find("input[type=checkbox]").not("#allCheck");
        for (var i = 0; i < checkArray.length; i++) {
            checkArray[i].checked = $("#allCheck")[0].checked;
        }
    })

    //特殊量表
    function LookR(vals, AmountType) {
        //window.location.href = "../PersonalReport/LookReport.aspx?A_ID=" + vals + "&type=1" + "&AmountType=" + AmountType + "";
        var answerAddID = $(this).parent().parent().find("input[type=checkbox]").attr("data-id");
        $.ajax({
            url: "Ajax/ViewResult.ashx?operationType=LookType",
            type: "GET",
            data: { A_ID: vals },
            dataType: "Text",
            success: function (data) {
                if (data == "2") {

                    window.location.href = "../PersonalReport/LookReport.aspx?A_ID=" + vals + "&type=1" + "&AmountType=" + AmountType + "";
                    //window.open("../PersonalReport/LookReport.aspx?A_ID=" + vals + "&type=1" + "&AmountType=" + AmountType + "");
                }
                else {
                    layer.alert('未获得相关权限！', {
                        skin: 'layui-layer-lan', //样式类名
                        closeBtn: 0,
                    });
                }
            }
        });
    }
    //特殊量表
    function LookRS(vals, types, AmountType) {
        // window.location.href = "../PersonalReport/SpecialReport.aspx?A_ID=" + vals + "&types=" + types + "&AmountType=" + AmountType + "";
        $.ajax({
            url: "Ajax/ViewResult.ashx?operationType=LookType",
            type: "GET",
            data: { A_ID: vals },
            dataType: "Text",
            success: function (data) {
                if (data == "2") {

                    window.location.href = "../PersonalReport/SpecialReport.aspx?A_ID=" + vals + "&type=1" + "&types=" + types + "&AmountType=" + AmountType + "";
                    //window.open("../PersonalReport/SpecialReport.aspx?A_ID=" + vals + "&type=1" + "&types=" + types + "&AmountType=" + AmountType + "");
                }
                else {
                    layer.alert('未获得相关权限！', {
                        skin: 'layui-layer-lan', //样式类名
                        closeBtn: 0,
                    });
                }
            }
        });

    }
    //特殊量表M
    function LookRSS(vals, types, AmountType) {
        //  window.location.href = "../PersonalReport/SpecialReportM.aspx?A_ID=" + vals + "&types=" + types + "&AmountType=" + AmountType + "";
        $.ajax({
            url: "Ajax/ViewResult.ashx?operationType=LookType",
            type: "GET",
            data: { A_ID: vals },
            dataType: "Text",
            success: function (data) {
                if (data == "2") {

                    window.location.href = "../PersonalReport/SpecialReportM.aspx?A_ID=" + vals + "&type=1" + "&types=" + types + "&AmountType=" + AmountType + "";
                    //window.open("../PersonalReport/SpecialReportM.aspx?A_ID=" + vals + "&type=1" + "&types=" + types + "&AmountType=" + AmountType + "");
                }
                else {
                    layer.alert('未获得相关权限！', {
                        skin: 'layui-layer-lan', //样式类名
                        closeBtn: 0,
                    });
                }
            }
        });
    }
    function LookRQuanxian() {
        layer.alert('未获得相关权限！', {
            skin: 'layui-layer-lan', //样式类名
            closeBtn: 0,
        });
    }
    /*---产看MMPI报告---*/
    function LookMMPI(AID) {
        window.location.href = "../PersonalReport/MMPI_Report.aspx?A_ID=" + AID + "&type=1" + "&AmountType=" + 1 + "";
        //window.open("../PersonalReport/MMPI_Report.aspx?A_ID=" + AID + "&type=1" + "&AmountType=" + 1 + "");
    }

    $(document).keyup(function (e) {
        if (e.keyCode === 13) {

            $('#go_search').trigger('click');
        }
    });
</script>